import openai

ORDER = """
## **1. åˆ†æã®åŸºæœ¬æ§‹é€ **
**IRè³‡æ–™ã‚’åˆ†æã™ã‚‹éš›ã®ä¸€è²«ã—ãŸæµã‚Œ**
1. **è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®æ•´ç†**
2. **ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãƒ»å¸‚å ´ç’°å¢ƒã®è€ƒå¯Ÿ**
3. **ç«¶äº‰ç’°å¢ƒã¨ã®æ¯”è¼ƒ**
4. **ãƒªã‚¹ã‚¯è¦å› ã®è©•ä¾¡**
5. **çµè«–ã¨ä»Šå¾Œã®æ³¨ç›®ç‚¹**

## **2. åˆ†æã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹**
### **â‘  ç›®çš„ã®æ˜ç¢ºåŒ–**
- **ã“ã®è³‡æ–™ã‹ã‚‰ä½•ã‚’èª­ã¿å–ã‚‹ã¹ãã‹ï¼Ÿ**
  - ä¼æ¥­ã®æˆé•·æ€§ã‚’è©•ä¾¡ã™ã‚‹ã®ã‹ï¼Ÿ
  - åç›Šæ€§ã‚„è²¡å‹™ã®å®‰å®šæ€§ã‚’è¦‹ã‚‹ã®ã‹ï¼Ÿ
  - ç«¶äº‰å„ªä½æ€§ã‚„å¸‚å ´ã‚·ã‚§ã‚¢ã‚’ç¢ºèªã™ã‚‹ã®ã‹ï¼Ÿ
- **æŠ•è³‡å®¶ãƒ»çµŒå–¶è€…ã®è¦–ç‚¹ã‚’æ„è­˜**
  - ä¼æ¥­ä¾¡å€¤ãŒé«˜ã¾ã‚‹è¦ç´ ã¯ä½•ã‹ï¼Ÿ
  - ä»Šå¾Œã®æˆé•·ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ä½•ã‹ï¼Ÿ

### **â‘¡ è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã®æ•´ç†**
**æ¥­ç•Œã‚„ä¼æ¥­è¦æ¨¡ã‚’å•ã‚ãšå…±é€šã™ã‚‹æŒ‡æ¨™**
| é …ç›® | æ„å‘³ | æ³¨ç›®ãƒã‚¤ãƒ³ãƒˆ |
|------|------|------------|
| å£²ä¸Šé«˜ | äº‹æ¥­ã®è¦æ¨¡ãƒ»æˆé•·åº¦åˆã„ | éå»ã¨æ¯”è¼ƒã—ã¦æˆé•·ã—ã¦ã„ã‚‹ã‹ï¼Ÿ|
| å–¶æ¥­åˆ©ç›Š | äº‹æ¥­ã®æœ¬æ¥­ã§ã®åç›Šæ€§ | åç›Šæ§‹é€ ãŒå®‰å®šã—ã¦ã„ã‚‹ã‹ï¼Ÿ |
| EPS (1æ ªã‚ãŸã‚Šåˆ©ç›Š) | æ ªä¸»ä¾¡å€¤ã®å¢—åŠ  | äºˆæƒ³ã¨æ¯”ã¹ã¦ã©ã†ã‹ï¼Ÿæˆé•·æ€§ã¯ï¼Ÿ |
| å–¶æ¥­CF | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã®å¥å…¨æ€§ | äº‹æ¥­æ´»å‹•ã§ç¨¼ã’ã¦ã„ã‚‹ã‹ï¼Ÿ |
| ROE / ROIC | æŠ•è³‡ã«å¯¾ã™ã‚‹ãƒªã‚¿ãƒ¼ãƒ³ | è³‡æœ¬åŠ¹ç‡ãŒé«˜ã„ã‹ï¼Ÿ |

- **æˆé•·æ€§ã®è©•ä¾¡**
  - å‰å¹´åŒæœŸæ¯”ãƒ»å¸‚å ´äºˆæƒ³ã¨ã®æ¯”è¼ƒ
  - éå»æ•°å¹´ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- **åç›Šæ€§ã®è©•ä¾¡**
  - å£²ä¸Šã¨åˆ©ç›Šã®ãƒãƒ©ãƒ³ã‚¹
  - å–¶æ¥­åˆ©ç›Šç‡ã®æ¨ç§»


### **â‘¢ ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãƒ»å¸‚å ´ç’°å¢ƒã®è€ƒå¯Ÿ**
- **åç›Šæº**
  - ã©ã®äº‹æ¥­ãŒä¸»ãªå£²ä¸Šãƒ»åˆ©ç›Šã‚’ç”Ÿã‚“ã§ã„ã‚‹ã‹ï¼Ÿ
  - å£²ä¸ŠãŒä¸€éæ€§ã‹ã€ç¶™ç¶šçš„ãªã‚‚ã®ã‹ï¼Ÿ
- **å¸‚å ´ã®æˆé•·æ€§**
  - ä¼æ¥­ãŒå±ã™ã‚‹å¸‚å ´ãŒæˆé•·ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
  - ãƒã‚¯ãƒ­ç’°å¢ƒï¼ˆæ™¯æ°—ã€è¦åˆ¶ãªã©ï¼‰ã®å½±éŸ¿ã¯ï¼Ÿ
- **ç«¶äº‰å„ªä½æ€§**
  - ä»–ç¤¾ã¨æ¯”ã¹ãŸå¼·ã¿ï¼ˆæŠ€è¡“ã€ãƒ–ãƒ©ãƒ³ãƒ‰ã€ã‚·ã‚§ã‚¢ã€ã‚³ã‚¹ãƒˆæ§‹é€ ï¼‰
  - å‚å…¥éšœå£ã¯é«˜ã„ã‹ï¼Ÿ

### **â‘£ ç«¶äº‰ç’°å¢ƒã¨ã®æ¯”è¼ƒ**
- **ç«¶åˆä»–ç¤¾ã¨ã©ã†é•ã†ã‹ï¼Ÿ**
  - æ¥­ç•Œå¹³å‡ã¨ã®æ¯”è¼ƒ
  - ã‚·ã‚§ã‚¢ã®æ¨ç§»ï¼ˆå¸‚å ´ã§ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ï¼‰
  - ä»–ç¤¾ã¨æ¯”è¼ƒã—ãŸæˆé•·ç‡ãƒ»åˆ©ç›Šç‡
- **ç«¶äº‰æˆ¦ç•¥**
  - ä¾¡æ ¼ç«¶äº‰å‹ vs å·®åˆ¥åŒ–æˆ¦ç•¥
  - ç ”ç©¶é–‹ç™ºï¼ˆR&Dï¼‰ã®æŠ•è³‡é¡

### **â‘¤ ãƒªã‚¹ã‚¯è¦å› ã®è©•ä¾¡**
- **è²¡å‹™ãƒªã‚¹ã‚¯**
  - è² å‚µæ¯”ç‡ã¯é©åˆ‡ã‹ï¼Ÿï¼ˆãƒ¬ãƒãƒ¬ãƒƒã‚¸ãŒé«˜ã™ããªã„ã‹ï¼‰
  - è³‡é‡‘ç¹°ã‚Šã«å•é¡Œã¯ãªã„ã‹ï¼Ÿï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼åˆ†æï¼‰
- **äº‹æ¥­ãƒªã‚¹ã‚¯**
  - ä¾å­˜åº¦ã®é«˜ã„é¡§å®¢ãƒ»å¸‚å ´ãŒã‚ã‚‹ã‹ï¼Ÿ
  - æ³•è¦åˆ¶ã‚„å¸‚å ´ç’°å¢ƒã®å¤‰åŒ–ã«ã‚ˆã‚‹å½±éŸ¿
- **ç«¶äº‰ãƒªã‚¹ã‚¯**
  - æ–°è¦å‚å…¥ã®è„…å¨ã¯ã‚ã‚‹ã‹ï¼Ÿ
  - ä¸»è¦ç«¶äº‰ç›¸æ‰‹ã®å‹•ã

### **â‘¥ çµè«–ã¨ä»Šå¾Œã®æ³¨ç›®ç‚¹**
**âœ… ãƒã‚¸ãƒ†ã‚£ãƒ–è¦å› **
- **æˆé•·è¦ç´ **ï¼ˆå£²ä¸Šãƒ»åˆ©ç›Šãƒ»å¸‚å ´ã‚·ã‚§ã‚¢ãŒä¼¸ã³ã¦ã„ã‚‹ï¼‰
- **åç›Šæ€§å‘ä¸Š**ï¼ˆåˆ©ç›Šç‡ãŒå®‰å®šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ãŒå¼·ã„ï¼‰
- **ç«¶äº‰åŠ›å¼·åŒ–**ï¼ˆå·®åˆ¥åŒ–ã€ãƒ–ãƒ©ãƒ³ãƒ‰ã€æŠ€è¡“å„ªä½ï¼‰

**âš ï¸ ãƒã‚¬ãƒ†ã‚£ãƒ–è¦å› **
- **æˆé•·éˆåŒ–**ï¼ˆå£²ä¸Šãƒ»åˆ©ç›Šæˆé•·ãŒåœæ»ï¼‰
- **ã‚³ã‚¹ãƒˆå¢—åŠ **ï¼ˆåŸææ–™è²»ã€R&Dã€äººä»¶è²»ã®è² æ‹…å¢—ï¼‰
- **å¸‚å ´ç’°å¢ƒã®æ‚ªåŒ–**ï¼ˆè¦åˆ¶ã€æ™¯æ°—å¾Œé€€ã€ç«¶äº‰æ¿€åŒ–ï¼‰

**ğŸ¯ ä»Šå¾Œã®æ³¨ç›®ç‚¹**
- ã©ã®æŒ‡æ¨™ãŒæ¬¡å›ã®æ±ºç®—ã§æ³¨ç›®ã•ã‚Œã‚‹ã‹ï¼Ÿ
- ä¼æ¥­ãŒæŠ±ãˆã‚‹èª²é¡Œã‚’ã©ã†æ”¹å–„ã™ã‚‹ã‹ï¼Ÿ

"""

def create_response(
    openai_client: openai.ChatCompletion,
    fact_sentence: str,
    order: str = ORDER,
) -> str:

    system_prompt = '''
    - æ¬¡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã£ã¦IRè³‡æ–™ã‚’åˆ†æã—ã€7000å­—ä»¥ä¸Šã§ä¸å¯§ã‹ã¤ã‚ã‹ã‚Šã‚„ã™ãæ•´ç†ã™ã‚‹ã“ã¨
    - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§ã¾ã¨ã‚ã‚‹ã“ã¨
    - å‰ç½®ããªã—ã§ç›´æ¥çš„ãªå›ç­”ã‹ã‚‰é–‹å§‹ã›ã‚ˆ
    '''
    context = order
    sentence = f'æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒIRã‚’æ–‡å­—èµ·ã“ã—ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚:{fact_sentence}'

    response = openai_client.chat.completions.create(
        model='o1-2024-12-17',
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "system", "content": context},
            {"role": "user", "content": sentence},
        ],
    )
    parsed_response = response.choices[0].message.content

    return parsed_response


def create_rag_response(
    openai_client: openai.ChatCompletion,
    context: str,
    prompt: str,
) -> str:

    system_prompt = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€ä¸å¯§ã«æ–‡ç« ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚å‰ç½®ããªã—ã§ç›´æ¥çš„ãªå›ç­”ã‹ã‚‰é–‹å§‹ã›ã‚ˆ'
    response = openai_client.chat.completions.create(
        model='gpt-4o',
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "system", "content": context},
            {"role": "user", "content": prompt},
        ],
    )
    parsed_response = response.choices[0].message.content
    return parsed_response
