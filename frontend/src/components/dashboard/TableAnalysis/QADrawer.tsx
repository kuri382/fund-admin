import React from 'react';
import { Drawer, List, Button } from 'antd';
import { MailOutlined, SlackOutlined } from '@ant-design/icons';

interface QADrawerProps {
    visible: boolean;
    onClose: () => void;
    summary: string[];
}

const formatText = (text: string | undefined) => {
    if (!text) return "";
    return text
        .replace(/####\s(.*?)(?:\n|$)/g, '<h3>$1</h3>') // ### を h3 タグに変換
        .replace(/###\s(.*?)(?:\n|$)/g, '<h3>$1</h3>') // ### を h3 タグに変換
        .replace(/##\s(.*?)(?:\n|$)/g, '<h2>$1</h2>') // ## を h2 タグに変換
        .replace(/#\s(.*?)(?:\n|$)/g, '<h2>$1</h2>') // # を h2 タグに変換
        //.replace(/^\d+\.\s(.*)$/gm, '<li>$1</li>') // 番号付きリストに対応
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        //.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // **text** を太字に変換
        .replace(/\n/g, '<br>'); // 改行に変換
};

const summary = [
    `

### 1. 売上高の推移
#### 売上高（百万円）
- **FY21/3**: 3,500
- **FY22/3**: 4,380
- **FY23/3（予想）**: 5,550

**分析**:
- FY21/3からFY22/3にかけて、売上高は880百万円（25.1%）の増加。
- FY22/3からFY23/3の予想では、1,170百万円（26.7%）の増加が見込まれています。
- 売上高の増加は、主にオンラインメディア事業の成長によるものと考えられます。

### 2. 営業利益の推移
#### 営業利益（百万円）
- **FY21/3**: 700
- **FY22/3**: 777
- **FY23/3（予想）**: 830

**分析**:
- FY21/3からFY22/3にかけて、営業利益は77百万円（11.0%）の増加。
- FY22/3からFY23/3の予想では、53百万円（6.8%）の増加が見込まれています。
- 売上高の増加に対して営業利益の増加率が鈍化しているため、コスト管理の課題が示唆されます。

### 3. 経常利益の推移
#### 経常利益（百万円）
- **FY21/3**: 720
- **FY22/3**: 784
- **FY23/3（予想）**: 830

**分析**:
- FY21/3からFY22/3にかけて、経常利益は64百万円（8.9%）の増加。
- FY22/3からFY23/3の予想では、46百万円（5.9%）の増加が見込まれています。
- 経常利益も営業利益と同様に、増加率が鈍化していることが懸念されます。

### 4. 事業セグメント別の分析
#### オンラインメディア事業
- **FY22/3**: 売上高 3,000百万円（全体の68%）
- **FY23/3（予想）**: 売上高 4,000百万円（全体の72%）

**分析**:
- オンラインメディア事業は、引き続き成長を続けており、全体の売上高に占める割合も増加しています。
- 競争が激化している中で、広告収入やデジタルコンテンツの提供が影響していると考えられます。

#### ITソリューション事業
- **FY22/3**: 売上高 600百万円（全体の14%）
- **FY23/3（予想）**: 売上高 800百万円（全体の14%）

**分析**:
- ITソリューション事業は、売上高の増加が見込まれていますが、全体に占める割合は横ばいです。
- 競争環境の変化により、顧客のニーズに応じたサービス提供が求められています。

#### 金融プラットフォーム事業
- **FY22/3**: 売上高 780百万円（全体の18%）
- **FY23/3（予想）**: 売上高 750百万円（全体の14%）

**分析**:
- 金融プラットフォーム事業は、売上高が減少する見込みであり、特に市場環境の変化や競争の激化が影響していると考えられます。
- 収益性の改善が急務であり、戦略的な施策が必要です。

### 5. 異常検知のポイント
- **売上高の増加率の鈍化**: 売上高は増加しているものの、営業利益や経常利益の増加率が鈍化していることは、コスト管理や競争環境の影響を示唆しています。
- **金融プラットフォーム事業の減少**: 売上高が減少する見込みであり、特に競争が激化していることが懸念されます。
- **ITソリューション事業の横ばい**: 売上高が増加する見込みであるものの、全体に占める割合が横ばいであることは、成長戦略の見直しが必要であることを示しています。

### 6. 結論
ABEJA社は、全体的には売上高の増加を達成しているものの、利益面での成長が鈍化していることが懸念されます。特に金融プラットフォーム事業の減少や、ITソリューション事業の成長が横ばいであることは、今後の戦略において重要な課題となります。コスト管理や新たな収益源の確保が求められる中で、競争環境に適応した施策が必要です
    `,
    `### QAリスト

    #### 1. 質問: 2023年3月期第3四半期の業績に関する詳細なデータはありますか？
    - **質問背景**: 業績の詳細な数値が不明なため、正確な分析が困難です。
    - **現在わかっていること**: 売上高は3,396百万円で前年同期比8.4%の増加。
    - **必要なデータのタイトル**: 2023年3月期第3四半期決算詳細
    - **必要データのフォーマットや形式**: ExcelまたはCSV形式で、売上高、営業利益、経常利益、純利益などの項目を含む。
    
    #### 2. 質問: オンラインメディア事業のセグメント別売上高の推移を教えてください。
    - **現在わかっていること**: オンラインメディア事業が売上の74%を占めている。
    - **質問背景**: オンラインメディア事業の成長を評価するために、セグメント別の詳細な売上高が必要です。
    - **必要なデータのタイトル**: オンラインメディア事業のセグメント別売上高推移
    - **必要データのフォーマットや形式**: グラフまたは表形式で、年度ごとの売上高を示す。
    
    #### 3. 質問: ITソリューション事業における顧客数の推移はどうなっていますか？
    - **現在わかっていること**: ITソリューション事業は売上高が359百万円に達している。
    - **質問背景**: 顧客数の推移が事業の成長を示すため、具体的な数値が必要です。
    - **必要なデータのタイトル**: ITソリューション事業の顧客数推移
    - **必要データのフォーマットや形式**: ExcelまたはCSV形式で、年度ごとの顧客数を含む。
    
    #### 4. 質問: 金融プラットフォーム事業の利益率に関するデータはありますか？
    - **現在わかっていること**: 売上高はFY22/3Qに210百万円とピークを迎えたが、FY23/3Qには133百万円に減少。
    - **質問背景**: 利益率の変動が事業の健全性を示すため、詳細なデータが必要です。
    - **必要なデータのタイトル**: 金融プラットフォーム事業の利益率推移
    - **必要データのフォーマットや形式**: 表形式で、年度ごとの売上高と利益を示す。
    
    #### 5. 質問: 過去のM&A活動に関する詳細な情報はありますか？
    - **現在わかっていること**: M&Aや新規事業への投資を強化する方針がある。
    - **質問背景**: M&Aが企業成長に与える影響を評価するため、具体的な情報が必要です。
    - **必要なデータのタイトル**: 過去のM&A活動の詳細
    - **必要データのフォーマットや形式**: 文書形式で、M&Aの対象企業、時期、目的、成果を含む。
    
    #### 6. 質問: 今後の業績予想に関する根拠や前提条件は何ですか？
    - **質問背景**: 業績予想の信頼性を評価するため、根拠や前提条件が必要です。
    - **必要なデータのタイトル**: 業績予想の根拠と前提条件
    - **必要データのフォーマットや形式**: 文書形式で、具体的な数値や市場動向を含む。
    
    #### 7. 質問: 競合他社との比較データはありますか？
    - **質問背景**: 競争環境を理解するために、競合他社との比較が必要です。
    - **必要なデータのタイトル**: 競合他社との業績比較データ
    - **必要データのフォーマットや形式**: 表形式で、主要な競合他社の売上高、利益、成長率を含む。
    `,
]

const QADrawer: React.FC<QADrawerProps> = ({ visible, onClose, summary }) => {
    return (
        <Drawer
            title="QA List"
            placement="right"
            width={600}
            onClose={onClose}
            visible={visible}
            footer={
                <div style={{ display: 'flex', padding: '5px' }}>
                    <Button icon={<MailOutlined />} type="primary" style={{ margin: '5px', padding: '5px' }}>
                        メールで送信する
                    </Button>
                    <Button icon={<SlackOutlined />} type="primary" style={{ margin: '5px', padding: '5px' }}>
                        Slackチャンネルに送信する
                    </Button>
                </div>
            }
        >
            <div style={{ color: '#262260' }} dangerouslySetInnerHTML={{ __html: formatText(summary[1]) }}></div>
        </Drawer>
    );
};

export default QADrawer;
